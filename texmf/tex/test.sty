% Włodek Bzyl <matwb@univ.gda.pl>                      12/XII 2007
%
% TODO:
%
% makra do składania przedziałów, wektorów, punktów w R^2 i R^3.
%   odcinek:  (1; 2)
%   wektor:   [1, 2]
%   punkt:    (1, 2)

\catcode`\@=11

\hsize=190mm
\vsize=267mm

\input ifpdf.sty

\ifpdf
  \pdfpagewidth=210truemm   % fixing broken \magnification
  \pdfpageheight=297truemm
  \pdfhorigin=9truemm
  \pdfvorigin=15truemm
  %
  \pdffontexpand\tenrm 30 20 5 autoexpand
  \rpcode\tenrm`-=150
  % enable font expansion and character protrusion
  \pdfadjustspacing=2
  \pdfprotrudechars=2
  %
  \input colorpdf.tex
  \pdfmapfile{+minion.map}
  \pdfmapfile{+myriad.map}
\else
  \advance\hoffset by -13.4truemm
  \advance\voffset by 4.6truemm
  \special{papersize=210mm,297mm}
  \input colordvi.tex
\fi

\newlinechar=`\^^J
\def\thisstyle{TEST}
\def\fileversion{3.14}
\def\filedate{22/I 2008}

\message{Format: `\thisstyle\space\fileversion'\space<\filedate>^^J}

\def\ZESTAWA{\begingroup\catcode`\^^M=12 \XZESTAWA}
\def\ZESTAWB{\begingroup\catcode`\^^M=12 \XZESTAWB}
\def\WHERE{\begingroup\catcode`\^^M=12 \XWHERE}
{\catcode`\^^M=12 %
 \gdef\XZESTAWA#1^^M{\gdef\XXZESTAWA{#1}\endgroup}%
 \gdef\XZESTAWB#1^^M{\gdef\XXZESTAWB{#1}\endgroup}%
 \gdef\XWHERE#1^^M{\gdef\XXWHERE{#1}\endgroup}}

% wartości domyślne
\ZESTAWA Zestaw A
\ZESTAWB Zestaw B
\WHERE ---

% Następne zadanie
\newcount\z@dcnt
\newcount\l@ttercnt \l@ttercnt=``
\def\Z{\global\advance\z@dcnt by 1 \global\l@ttercnt=``
  \vskip\medskipamount
  \noindent{\bf\number\z@dcnt.\enspace}\ignorespaces}
\def\ZA{\Z\A}
\def\resetZcounter{\global\z@dcnt=0\relax}

% Zapisz odpowiedź do pliku
\newwrite\answers
\immediate\openout\answers=klucz.tex
\immediate\write\answers{\string\odZestawu=0 }

\newtoks\ttt
\def\append#1{\ttt=\expandafter{\the\ttt#1}}
\newcount\totalans \totalans=3
\newcount\currentans \currentans=1
% Lepszy interfejs..
% Zmienić, jeśli liczba zadań różna od 50!
%\newcount\maxincol \maxincol=25
\newcount\maxincol \maxincol=100
\newcount\currentrow \currentrow=1
\newcount\boxno \boxno=0

% Wybierz między a), b), c)
\def\emspace{\kern1em }
\def\hang{\hangindent\parindent}
\def\textindent#1{\append#1%
   \ifnum\currentans=\totalans
      \ifnum\currentrow=1
         \immediate\write\answers{\noexpand\key \number\boxno}%
         \global\advance\boxno by 2
      \fi
      \global\currentans=1
      \immediate\write\answers{\noexpand\R \the\ttt}\ttt={}%
%      \ifnum\currentrow=\maxincol
%         \immediate\write\answers{\noexpand\endkey}%
%         \global\currentrow=1
%      \else
         \global\advance\currentrow by 1
%      \fi
   \else
      \global\advance\currentans by 1
   \fi
   \indent\llap{\char\l@ttercnt)\emspace}\ignorespaces}

\outer\def\bye{\par\vfill
%  \immediate\write\answers{\noexpand\endkey}%
  \supereject\end}

\def\A{\global\advance\l@ttercnt by 1\hang\textindent}
\def\B{\emspace\A}
\let\C=\B

\def\a{\par\A}
\let\b=\a
\let\c=\a

\def\#{\medskip}
\def\NL{\hfil\break}

% Obrazki..
% Lepszy interfejs: \rightpicture <fname> rightoffset=<dimen>
\def\rightpicture#1#2%
  {\vadjust{\rightline{\smash{\hbox{\eps{#1}}}\kern#2}}}

\def\odploop#1\repeat{\global\def\odploopbody{#1}\odpiterate}
\def\odpiterate{\odploopbody \let\next\odpiterate \else\let\next\relax\fi \next}

\font\manual=manfnt at 18bp % font used for the METAFONT logo, etc.
\def\dbend{{\manual\char127}} % dangerous bend sign

\def\printheader #1{\resetZcounter
  \bigbreak
  \begingroup
  \fontsetup{12}{10}{8}{14}{12}{10}{14}
  \vbox{\halign{&\hss\bf##\quad\cr
     \lower5pt\hbox{\dbend}\kern 34pt Zestaw:&
        \number\year~/ #1\cr\noalign{\medskip}
  Nazwisko:\cr\noalign{\medskip}
  Imię:\cr}}
%%   Grupa:\cr\noalign{\medskip}
%%     Nazwisko, Imię:\cr}}
  \bigskip
  \hrule
  \medskip
  \endgroup}

\def\inter{\medskip\noindent\ignorespaces}

\newcount\odpcounter
\newdimen\odpvsize \odpvsize=0mm % nie działa
\def\ODP{\odpcounter=0
  \bigskip\ignorespaces
  \begingroup\offinterlineskip
  \halign{\vrule##&
      \hbox to \hsize{\hss\vbox to \odpvsize{\parindent=5pt
         \vrule height 12pt width 0pt\ignorespaces##\vss}}&
      \vrule##\cr\noalign{\hrule}
      \odploop\global\advance\odpcounter by 1
         &\number\odpcounter&\cr\noalign{\hrule}
      \ifnum\odpcounter<\z@dcnt \repeat\cr}
  \endgroup}

% Klucze
\newcount\odZestawu \odZestawu=0
\def\!{\vrule height 3mm depth 1mm width 0mm}
\def\crrule{\cr\noalign{\hrule}}
%\font\afont=plr10

% Główka
\def\G{\!&\rm ZAD&& a&& b&& c&\cr}
% Rozwiązanie
\def\R#1#2#3{\!&\global\advance\odZestawu by 1
   \rm\number\odZestawu &&$#1$&&$#2$&&$#3$&\crrule}

\def\key#1{\setbox #1=\vbox\bgroup\offinterlineskip
   \halign\bgroup\!\vrule##&\hbox to 16mm{\hss##\hss}&&
       \vrule##&\hbox to 10mm{\rm\hfil##\hfil}\cr\noalign{\hrule}
     \G\noalign{\hrule}}
\def\endkey{\egroup\egroup}

%\def\keys#1#2{\line{\hss\box#1\hskip0.5in\box#2\hss}}
\def\keys{\hbox to 190mm{\hss\box0\hss}}

\def\printkeys{\immediate\write\answers{\noexpand\endkey}%
   \vfil\eject
   \def\rightfootline{\tenit\XXZESTAWA\hfil\XXZESTAWB}
   \let\leftfootline=\rightfootline
   \immediate\closeout\answers
%   \centerline{ZESTAW \XXZESTAW}
   \NAGLOWEK
%   \vskip2\baselineskip
   \input klucz.tex
%   \keys02
   \begingroup
   \fontsetup{10}{7}{5}{10}{7}{5}{12}
   \keys
   \medskip
   \noindent{\tenit Legenda:\enspace$+=\hbox{TAK}$\quad$-=\hbox{NIE}$}
   \par
   \endgroup}

% Krótki opis testu -- reszta
\def\NAGLOWEK{\begingroup
   \fontsetup{14}{12}{10}{14}{12}{10}{17}
   \hbox to \hsize{\rm\XXZESTAWA\hfil\XXWHERE\hfil\XXZESTAWB}
   \par
   \endgroup}

% Parametry matematyczne
\everymath={\displaystyle}
\mathcode`\,="013B
\mathchardef\forallop="1356 \def\forall{\forallop\limits}
\mathchardef\existsop="1357 \def\exists{\existsop\limits}
\def\:{\,{:}\,\,}

\def\raggedright{\rightskip\z@ plus5em \spaceskip.3333em \xspaceskip.5em\relax}

% Dodatkowe makra
\def\dotproduct#1#2{\overrightarrow{#1}\circ\overrightarrow{#2}}
\def\vector#1{\overrightarrow{#1}}

% OTR

\maxdepth=2.2pt

%\def\plainoutput{\shipout\vbox{\pagebody\makefootline}%
%  \advancepageno}
\def\pagebody{\vtop{\boxmaxdepth\maxdepth \pagecontents}}
\def\pagecontents{\dimen@=\dp\@cclv \unvbox\@cclv} % open up \box255

\def\leftfootline{\hss\tenit\folio\hss}
\def\rightfootline{\tenit
  \rlap{Zestaw\enspace{\XXZESTAW}\qquad\XXWHERE}%
  \hss\tenit\folio\hss}
\def\firstfootline{\relax}
\footline={\ifnum\pageno=1\firstfootline\else
    \ifodd\pageno\rightfootline\else\leftfootline\fi\fi}

\newdimen\fullhsize
\fullhsize=\hsize \hsize=0.44\hsize
\def\fullline{\hbox to \fullhsize}

\let\lr=L \newbox\leftcolumn

\output{\if L\lr
  \global\setbox\leftcolumn\columnbox \global\let\lr=R
  \else \doubleformat \global\let\lr=L\fi
  \ifnum\outputpenalty>-20000 \else\dosupereject\fi}

\def\doubleformat{\shipout
  \vbox{\fullline{\box\leftcolumn\hfil\vrule\hfil\columnbox}
  \makefootline}
  \advancepageno}
\def\columnbox{\leftline{\pagebody}}

\font\sectionFont=MyriadPro-Bold--plrm--Fcpsp--Fkern--Fonum--Fpnum--base at 12pt

\def\Kolokwium{\bigskip\leftline{\hskip35pt \sectionFont Kolokwium}\medskip}
\def\Egzamin{\bigskip\leftline{\hskip35pt \sectionFont Egzamin}\medskip}

% Pozostałe parametry
\parskip=0pt plus 3pt
\interlinepenalty=10000
\parindent=2em
\raggedright

\catcode`\@=0
\endinput
